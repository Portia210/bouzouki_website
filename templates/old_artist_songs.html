{% extends 'base.html' %}

{% block title %}{{artist_data["artist_en_name"]}}{% endblock %}

{% block content %}

<main>
    <section id="artist-hero" class="bg-dark">
        <div class="container  text-secondary">
            <div class="row align-items-center g-lg-5 py-5">
                <div class="col-lg-6 text-center text-lg-start d-flex justify-content-center">
                    <div>
                        <p class="col-lg-10 fs-4 text-secondary">Songs By</p>
                        <h1 class="display-5 text-white lh-1 mb-3">{{artist_data["artist_en_name"]}}</h1>
                        <h4 class=" text-white lh-1 mb-3">{{artist_data["artist_gr_name"]}}</h4>
                    </div>
                </div>
                <div class="col-md-10 mx-auto col-lg-6 d-flex justify-content-center">
                    <div class="card shadow-sm" style="max-width: 300px">
                        <img class="bd-placeholder-img card-img-top" src="{{artist_data['img_url']}}" alt="Thumbnail">
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section id="songs-section">
        <div class="container">
            <div class="row align-items-start py-5">
                <div class="col-lg-6 mt-5 text-center text-lg-start d-flex flex-column justify-content-start">
                    <h4 class="lh-1 py-2">Artist Songs</h4>
                    <div class="scrollable-list">
                        <ul class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                            {% for song_name, song in artist_data["songs"].items() %}
                            <li id="{{ song['song_en_name'].replace(' ', '-').lower() }}" class="list-group-item d-flex justify-content-between ps-1 pe-3">
                                {{ song["song_en_name"] }}
                                <a href="#" class="link-primary ms-1"
                                   onclick="activateIframe({{ song | tojson }}, event);">View Song</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="col-md-10 mx-auto col-lg-6 d-flex justify-content-center align-items-start">
                    <div>
                        <div class="my-3">
                            <h4 class="display-6 lh-1 py-2">Original Song</h4>
                            <iframe id="iframe-song"
                                    width="500"
                                    height="315"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen
                                    title="YouTube Video"
                                    loading="lazy"
                            ></iframe>
                            <p><span id="song_name"></span><a id="more-videos" target="_blank"
                                                              class="link-primary ms-2"
                                                              href="">Other Videos</a></p>
                        </div>
                        <div class="my-3">
                            <h4 class="display-6 lh-1 py-2">Sheet Music</h4>
                            <iframe id="iframe-sheet"
                                    width="500"
                                    height="315"
                                    frameborder="0"
                                    allow=" accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen
                                    title="YouTube Video"
                                    loading="lazy"
                            ></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    function activateIframe(song, event) {
        event.preventDefault();
        var song_iframe = document.getElementById('iframe-song');
        var sheet_iframe = document.getElementById('iframe-sheet');
        var more_results = document.getElementById('more-videos');
        var song_name_elem = document.getElementById('song_name');

        // Replace the iframe source with the specified demo ID
        more_results.href = song.more_videos;
        song_name_elem.textContent = song.song_en_name;
        replaceIframeContent(song_iframe, 'https://www.youtube.com/embed/' + song["video_id"]);
        replaceIframeContent(sheet_iframe, 'https://www.youtube.com/embed/' + song["demo_id"]);
    }

    function replaceIframeContent(iframe, newSrc) {
        iframe.contentWindow.location.replace(newSrc);
    }

    var firstSong = Object.values({{artist_data["songs"]|tojson}})[0];
    activateIframe(firstSong, new Event('click'));

    // Scroll to the anchor if it exists
    window.onload = function() {
        if(window.location.hash) {
            var anchor = decodeURIComponent(window.location.hash);
            var element = document.querySelector(anchor);
            if(element) {
                element.scrollIntoView({behavior: "smooth"});
                // Activate the iframe for the selected song
                var songData = JSON.parse(element.querySelector('a').getAttribute('onclick').match(/activateIframe\((.*?),/)[1]);
                activateIframe(songData, new Event('click'));
            }
        }
    }
</script>

{% endblock %}